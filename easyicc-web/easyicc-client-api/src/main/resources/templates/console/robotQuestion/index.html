<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>后台管理中心 - 知识库配置</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="${basePath}/assets/media/image/favicon.png"/>

    <!-- Plugin styles -->
    <link rel="stylesheet" href="${basePath}/vendors/bundle.css" type="text/css">
    <!-- Prism -->
    <link rel="stylesheet" href="${basePath}/vendors/prism/prism.css" type="text/css">
    <!-- App styles -->
    <link rel="stylesheet" href="${basePath}/assets/css/app.css" type="text/css">
</head>
<body>

<!-- begin::preloader-->
<div class="preloader">
    <div class="preloader-icon"></div>
</div>
<!-- end::preloader -->


<!-- begin::main -->
<div id="main">

    <!-- begin::navigation -->
    <div class="navigation">

        <div class="navigation-menu-tab">
            <div>
                <div class="navigation-menu-tab-header" data-toggle="tooltip" title="首页" data-placement="right">
                    <a href="#" class="nav-link" data-toggle="dropdown" aria-expanded="false">
                        <i data-feather="home"></i>
                    </a>

                </div>
            </div>
				<div class="flex-grow-1">
					<ul>
						<li><a href="#" data-toggle="tooltip" data-placement="right"
							title="首页" data-nav-target="#personCommon"> <i
								data-feather="home"></i>
						</a></li>
						<li><a href="#" data-toggle="tooltip" data-placement="right"
							title="个人常用功能" data-nav-target="#personCommon"> <i
								data-feather="user"></i>
						</a></li>
						<li><a href="#" data-toggle="tooltip" data-placement="right"
							title="系统状态监控" data-nav-target="#systemStatusMonitor"> <i
								data-feather="monitor"></i>
						</a></li>
						<li><a class="active" href="#" data-toggle="tooltip" data-placement="right"
							title="智能微微配置" data-nav-target="#robotConfig"> <i
								data-feather="user-plus"></i>
						</a></li>
						<li><a href="#" data-toggle="tooltip" data-placement="right"
							title="辅助功能管理" data-nav-target="#assistConfig"> <i
								data-feather="tool"></i>
						</a></li>
						<li><a href="#" data-toggle="tooltip" data-placement="right"
							title="咨询入口管理" data-nav-target="#consultConfig"> <i
								data-feather="message-square"></i>
						</a></li>
						<li><a href="#" data-toggle="tooltip" data-placement="right"
							title="网页样式配置" data-nav-target="#pageStyleConfig"> <i
								data-feather="file-plus"></i>
						</a></li>
						<li><a href="#" data-toggle="tooltip"
							data-placement="right" title="基础信息设置"
							data-nav-target="#basicSettings"> <i data-feather="settings"></i>
						</a></li>
					</ul>
				</div>

			</div>

        <!-- begin::navigation menu -->
        <div class="navigation-menu-body">

            <!-- begin::navigation-logo -->
             <div>
                <div id="navigation-logo">
                    <a href="index.html">
                        <img class="logo" src="${basePath}/assets/media/image/logo.png" alt="logo">
                        <img class="logo-light" src="${basePath}/assets/media/image/logo-light.png" alt="light logo">
                    </a>
                </div>
            </div>
            <!-- end::navigation-logo -->

            <div class="navigation-menu-group">

                 <div id="personCommon">
                    <ul>
                        <li class="navigation-divider">个人常用功能</li>                        
                        <li><a href="${basePath}/autoReply/edit.html">自动回复设置</a></li>
                        <li><a href="${basePath}/chatStaffMessage/index.html">内部聊天记录</a></li>
                        <li><a href="${basePath}/commonLanguage/index.html">个人常用语</a></li>
                        <li><a href="${basePath}/changePassword/index.html">修改登录密码</a></li>
                     </ul>

                </div>
                <div id="systemStatusMonitor">
                    <ul>
                        <li class="navigation-divider">系统状态监控</li>
                        <li><a href="${basePath}/log/statusChange.html">客服状态日志查询</a></li>                        
                        <li><a href="${basePath}/monitor/groupIndex.html">分组信息监控</a></li>
                        <li><a href="${basePath}/log/login.html">客服登录日志查询</a></li>
                        <li><a href="${basePath}/log/opration.html">系统操作日志查询</a></li>
                    </ul>
                </div>
                <div class="open" id="robotConfig">
                    <ul>
                        <li class="navigation-divider">智能微微配置</li>
                        <li>
                            <a href="${basePath}/robot/index.html">
                                <span>问候语配置</span>
                            </a>
                        </li>
                        <li>
                            <a class="active"  href="${basePath}/robotQuestion/index.html">
                                <span>知识库配置</span>
                            </a>
                        </li>
                        <li>
                            <a href="${basePath}/robotQuestionCategory/index.html">
                                <span>知识库分类</span>
                            </a>
                        </li>
                    
                    </ul>
                </div>
                
               <div id="basicSettings">
                    <ul>
                        <li><a href="${basePath}/iccAccount/index.html"">客服账号管理</a></li>
                        <li><a href="${basePath}/skillGroup/index.html">客服分组管理</a></li>
                        <li><a href="${basePath}/department/index.html">部门信息管理</a></li>
                        <li><a href="${basePath}/role/index.html">公司角色管理</a></li>
                        <li><a href="${basePath}/role/assignRole.html">公司角色分配</a></li>
                        <li><a href="${basePath}/rewriteRule/index.html">接入策略管理</a></li>
                        <li><a href="${basePath}/promotionChannel/index.html">接入渠道配置</a></li>
                        <li><a href="${basePath}/visitorFilter/index.html">访客屏蔽管理</a></li>

                        <li><a href="${basePath}/site/index.html">子站点管理</a></li>
                                            <li><a href="${basePath}/organize/edit.html">公司信息配置</a></li>
                        <li><a href="${basePath}/organizeConfig/edit.html">公司全局配置</a></li>

                    </ul>
                </div>
            </div>
        </div>
        <!-- end::navigation menu -->

    </div>
    <!-- end::navigation -->

    <!-- begin::main-content -->
    <main class="main-content">

        <div class="page-header">
            <div class="container-fluid d-sm-flex justify-content-between">
                <h4>知识库配置</h4>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <button type="button" class="btn btn-danger btn-square btn-uppercase" data-toggle="modal" data-target="#addSiteMode">
                                <i class="ti-plus mr-2"></i> 新增
                                 
                            </button>
                    </ol>
                    
                </nav>
            </div>
        </div>


        <div class="container-fluid">

			<div class="row">
				<div class="col-md-12">

					<table class="table mb-4 mt-4">
						<thead class="thead-light">
							<tr>
								<th>#</th>
								<th class="text-left">问题 </th>
								<th class="text-left">类别 </th>
								<th class="text-left">关键字 </th>
								<th class="text-left">答案  </th>
								<th class="text-left">状态  </th>
								
								<th class="text-left">创建人   </th>
								<th class="text-left">创建时间   </th>
								<th class="text-left">最后修改人   </th>
								<th class="text-left">最后修改时间 </th>
							</tr>
						</thead>
						<tbody>
							<#if pageInfo.list?? && (pageInfo.list?size > 0) >
								<#list pageInfo.list as question>
								<tr class="text-left">
									<td class="text-left">${question_index+1}</td>
									<td class="text-left">${question.question!}</td>
									<td class="text-left">-</td>
									<td class="text-left">${question.question!}</td>
									<td class="text-left">-</td>
									<td class="text-left">-</td>
									<td class="text-left">-</td>
									<td class="text-left">
									<a class="badge badge-success" onclick="editQuestion('${question.id!}')">修改</a>
									<a class="badge badge-danger" onclick="deleteQuestion('${question.id!}')">删除</a>
									
									 </td>
	
								</tr>
								</#list>
								<#else>
								<tr class="text-center">
								<td colspan=8 class="text-center">无数据</td>
								</tr>
							</#if>
						</tbody>
					</table>

				</div>
			</div>

		</div>

        <!-- end::footer -->

    </main>
    <!-- end::main-content -->

</div>
<!-- end::main -->
<!-- insert modal begin-->
<div class="modal fade" id="addSiteMode" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
     <form id="addSiteForm"  onsubmit="return checkAddSiteForm()">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel">新增知识信息</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <i class="ti-close"></i>
        </button>
      </div>
	<div class="modal-body">
		<div class="form-group">
			<label for="message-text" class="col-form-label">机器人:</label>
			<select class="select2-example" id="robotId" name="robotId">
            <#list robotList as robot>
			  <option value="${robot.robotId!}">${robot.name!}</option>
			</#list>
			
			</select>
		</div>
		<div class="form-group">
			<label for="message-text" class="col-form-label">类别:</label>
			<textarea class="form-control" id="depict" name="depict"
				placeholder="请输入子站点描述内存"></textarea>
		</div>
		<div class="form-group">
			<label for="recipient-name" class="col-form-label">问题:</label> <input
				type="text" class="form-control" id="question" name="question"
				placeholder="请输入" required="">
			<div class="invalid-feedback" id="question-feedback"></div>
		</div>
		<div class="form-group">
			<label for="recipient-name" class="col-form-label">答案:</label> <input
				type="text" class="form-control" id="answer" name="answer"
				placeholder="请输入" required="">
			<div class="invalid-feedback" id="answer-feedback"></div>
		</div>

	</div>
	   <div class="modal-footer">
          <button  type="button" class="btn btn-primary"  id="saveSiteButton" onClick="saveSite()">保存</button>
       </div>
       </form>
     </div>
  </div>
</div>
<script type="text/javascript">
$(document).ready(function () {

    $('#categoryId').select2({
        placeholder: 'Select'
    });

});
//以检查用户名不能为空不能有特殊符号为例
function checkAddSiteForm(){
        var question = document.getElementById("question");//获取question那个div
        var feedback = document.getElementById("question-feedback");
        //不能为空
        if(question.value==""){
            feedback.innerHTML = "请输入子站点名称！";//修改question-feedback div中的内容
            question.classList.remove("is-valid");//清除合法状态
            question.classList.add("is-invalid");//添加非法状态
            return false;
        }
        //不能有特殊符号
        var patrn = /[@#\$%\^&\*]+/g;//正则表达式
        if(patrn.exec(question.value)){
            feedback.innerHTML = "用户名不能存在特殊符号！";
            question.classList.remove("is-valid");
            question.classList.add("is-invalid");
            return false;
        }

        //清除错误提示，改成成功提示
        question.classList.remove("is-invalid");
        question.classList.add("is-valid");
        feedback.innerHTML="";
        return true;
    }
function saveSite(){
	if(checkAddSiteForm()){
		alert($("#addSiteForm").serialize());
		$.ajax({
	        type: 'POST',
	        url: '${basePath}/robotQuestion/save.do',
	        dataType: 'json',
	        data: $("#addSiteForm").serialize(),
	        //发送数据前
	        beforeSend: function(){
	            // 禁用按钮防止重复提交
	            $('#saveSiteButton').attr({disabled: "disabled"});
	            //弹出modal框
	           // $('#modal_sm_black_content').html('<img src="loading-white.gif" width="18" height="18" class="mr-2">正在处理，请稍后');
	           // $("#addSiteMode").modal("show");
	        },
	        //成功返回
	        success: function(data){
	            setTimeout(function(){
	                //隐藏modal框
	                $('#saveSiteButton').removeAttr('disabled');
	                $('#addSiteMode').modal('hide');
	                switch(data){
	                    case 'success':
	                        //操作成功，弹出modal框
	                      //  $('#modal_sm_black_content').html('<i class="fas fa-check-circle mr-2"></i>操作成功');
	                        //$("#addSiteMode").modal("show");
	                        window.location.reload();
	                        break;
	                }
	            }, 1);
	        },
	        //处理完成
	        complete: function(){
	            $('#saveSiteButton').removeAttr('disabled');
	            $('#saveSiteButton').modal('hide');
	        },
	        //报错
	        error: function(data){
	            console.info("error: " + data.responseText);
	        }
	    });			
	}
}
function deleteQuestion(ids){
	$.ajax({
        type: 'POST',
        url: '${basePath}/robotQuestion/delete.do',
        dataType: 'json',
        data: {ids:ids},
        success: function(data){
			if(data.code==0)
        	window.location.reload();
        },
        error: function(data){
            console.info("error: " + data.responseText);
        }
    });		
}
</script>
<!-- insert modal end -->

<!-- Plugin scripts -->
<script src="${basePath}/vendors/bundle.js"></script>
<!-- Prism -->
<script src="${basePath}/vendors/prism/prism.js"></script>
<!-- App scripts -->
<script src="${basePath}/assets/js/app.js"></script>
</body>
</html>